<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home Budget Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        input, select { margin-bottom: 10px; padding: 5px; }
        button { padding: 5px 10px; }
        h1, h2 { margin-top: 30px; }
        td.negative { color: red; }
    </style>
</head>
<body>
    <h1>Home Budget Tracker</h1>

    <!-- Start Date and Opening Balance -->
    <div>
        <label for="startDateInput">Start Date:</label>
        <input type="date" id="startDateInput" oninput="updateStartDate(this.value)">
        <br>
        <label for="openingBalanceInput">Opening Balance:</label>
        <input type="number" id="openingBalanceInput" step="0.01" oninput="updateOpeningBalance(this.value)">
    </div>

    <!-- Add Transaction -->
    <h2>Add Transaction</h2>
    <div>
        <input type="date" id="transactionDate">
        <input type="text" id="transactionCategory" placeholder="Category">
        <select id="transactionType">
            <option value="Income">Income</option>
            <option value="Expense">Expense</option>
        </select>
        <input type="number" id="transactionAmount" placeholder="Amount" step="0.01">
        <select id="transactionFrequency">
            <option value="Monthly">Monthly</option>
            <option value="4 Weekly">4 Weekly</option>
            <option value="Irregular">Irregular</option>
        </select>
        <button onclick="addTransactionFromInputs()">Add</button>
    </div>

    <!-- Transactions Table -->
    <h2>Transactions</h2>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Category</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Frequency</th>
                <th>Running Balance</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="transactionsTableBody"></tbody>
    </table>

    <!-- 24-Month Projection -->
    <h2>24-Month Balance Projection</h2>
    <table>
        <thead>
            <tr><th>Month</th><th>Projected Balance</th></tr>
        </thead>
        <tbody id="projectionTableBody"></tbody>
    </table>

    <script>
        // ======== VARIABLES ========
        let transactions = [];
        let startDate = '';
        let openingBalance = 0;

        // ======== LOAD DATA FROM LOCAL STORAGE ========
        window.addEventListener('load', () => {
            const savedTransactions = localStorage.getItem('transactions');
            if (savedTransactions) { transactions = JSON.parse(savedTransactions); }

            const savedStartDate = localStorage.getItem('startDate');
            if (savedStartDate) {
                startDate = savedStartDate;
                document.getElementById('startDateInput').value = startDate;
            }

            const savedOpeningBalance = localStorage.getItem('openingBalance');
            if (savedOpeningBalance) {
                openingBalance = parseFloat(savedOpeningBalance);
                document.getElementById('openingBalanceInput').value = openingBalance;
            }

            displayTransactions();
            displayProjection();
        });

        // ======== SAVE FUNCTIONS ========
        function saveTransactions() { localStorage.setItem('transactions', JSON.stringify(transactions)); }
        function saveSettings() {
            localStorage.setItem('startDate', startDate);
            localStorage.setItem('openingBalance', openingBalance);
        }

        // ======== UPDATE START DATE / OPENING BALANCE ========
        function updateStartDate(value) { startDate = value; saveSettings(); displayProjection(); }
        function updateOpeningBalance(value) { openingBalance = parseFloat(value) || 0; saveSettings(); displayProjection(); }

        // ======== ADD TRANSACTION ========
        function addTransaction(date, category, type, amount, frequency) {
            if (!date || !category || !amount) { alert("Please fill in date, category, and amount."); return; }
            transactions.push({ date, category, type, amount: parseFloat(amount), frequency });
            saveTransactions(); displayTransactions(); displayProjection();
        }

        function addTransactionFromInputs() {
            const date = document.getElementById('transactionDate').value;
            const category = document.getElementById('transactionCategory').value;
            const type = document.getElementById('transactionType').value;
            const amount = document.getElementById('transactionAmount').value;
            const frequency = document.getElementById('transactionFrequency').value;
            addTransaction(date, category, type, amount, frequency);

            document.getElementById('transactionDate').value = '';
            document.getElementById('transactionCategory').value = '';
            document.getElementById('transactionAmount').value = '';
        }

        // ======== DELETE TRANSACTION ========
        function deleteTransaction(index) {
            if (confirm("Delete this transaction?")) {
                transactions.splice(index, 1);
                saveTransactions();
                displayTransactions();
                displayProjection();
            }
        }

        // ======== DISPLAY TRANSACTIONS WITH RUNNING BALANCE ========
        function displayTransactions() {
            const tableBody = document.getElementById('transactionsTableBody');
            tableBody.innerHTML = '';
            const sorted = transactions.slice().sort((a,b)=>new Date(a.date)-new Date(b.date));
            let runningBalance = openingBalance;

            sorted.forEach(t => {
                runningBalance += (t.type === 'Income' ? t.amount : -t.amount);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${t.date}</td>
                    <td>${t.category}</td>
                    <td>${t.type}</td>
                    <td>${t.amount.toFixed(2)}</td>
                    <td>${t.frequency}</td>
                    <td class="${runningBalance<0?'negative':''}">${runningBalance.toFixed(2)}</td>
                    <td><button onclick="deleteTransaction(${transactions.indexOf(t)})">Delete</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // ======== 24-MONTH PROJECTION ========
        function projectFutureBalance() {
            const projectionStart = startDate ? new Date(startDate) : new Date();
            let balance = openingBalance;
            const projectedTransactions = [];

            for (let monthOffset = 0; monthOffset < 24; monthOffset++) {
                const currentMonth = new Date(projectionStart);
                currentMonth.setMonth(projectionStart.getMonth() + monthOffset);

                transactions.forEach(t => {
                    const tDate = new Date(t.date);
                    let applyTransaction = false;

                    if (t.frequency === 'Monthly') applyTransaction = true;
                    else if (t.frequency === '4 Weekly') {
                        const diffDays = Math.floor((currentMonth - tDate)/(1000*60*60*24));
                        if (diffDays>=0 && diffDays%28<7) applyTransaction = true;
                    }
                    else if (t.frequency === 'Irregular') {
                        if (tDate.getMonth()===currentMonth.getMonth() && tDate.getFullYear()===currentMonth.getFullYear())
                            applyTransaction = true;
                    }

                    if (applyTransaction) balance += (t.type==='Income'?t.amount:-t.amount);
                });

                projectedTransactions.push({
                    month: currentMonth.toLocaleString('default',{month:'short', year:'numeric'}),
                    balance: balance.toFixed(2)
                });
            }

            return projectedTransactions;
        }

        function displayProjection() {
            const table = document.getElementById('projectionTableBody');
            table.innerHTML = '';
            const projection = projectFutureBalance();
            projection.forEach(p => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${p.month}</td><td class="${parseFloat(p.balance)<0?'negative':''}">${p.balance}</td>`;
                table.appendChild(row);
            });
        }
    </script>
</body>
</html>
